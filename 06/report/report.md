---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: " Адресация IPv4 и IPv6. Двойной стек"
author: "Хамди Мохаммад"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---


# Цель работы

Изучение принципов распределения и настройки адресного пространства на устройствах сети.

# Ход выполнения

## Разбиение IPv4-сети на подсети

### Сеть `172.16.20.0/24`

**Характеристики исходной сети**
- Префикс: `/24`
- Маска: `255.255.255.0`
- Широковещательный (broadcast): `172.16.20.255`
- Диапазон узлов: `172.16.20.1 – 172.16.20.254`
- (Классическая модель) Базовая сеть класса B `172.16.0.0/16`, занято под подсеть `24 − 16 = 8` бит → **число подсетей: `2^8 = 256`**

**Требование:** разбить на 3 подсети с максимально возможным числом узлов: **126, 62, 62**.  
Это VLSM: `/25` (126 хостов) + два `/26` (по 62 хоста).

| Подсеть | Префикс | Маска | Сетевой | Диапазон узлов | Broadcast | Число узлов |
|---|---:|---|---|---|---|---:|
| 1 | `/25` | 255.255.255.128 | `172.16.20.0` | `172.16.20.1 – 172.16.20.126` | `172.16.20.127` | 126 |
| 2 | `/26` | 255.255.255.192 | `172.16.20.128` | `172.16.20.129 – 172.16.20.190` | `172.16.20.191` | 62 |
| 3 | `/26` | 255.255.255.192 | `172.16.20.192` | `172.16.20.193 – 172.16.20.254` | `172.16.20.255` | 62 |

### Сеть `10.10.1.64/26`

**Характеристики исходной сети**
- Префикс: `/26`
- Маска: `255.255.255.192`
- Сетевой адрес: `10.10.1.64` (шаг 64)
- Диапазон узлов: `10.10.1.65 – 10.10.1.126`
- Broadcast: `10.10.1.127`
- (Классическая модель) Базовая сеть класса A `10.0.0.0/8`, занято `26 − 8 = 18` бит → **число подсетей: `2^18 = 262 144`**

**Выделить подсеть на 30 узлов.** Нужен префикс `/27` (32 адреса, 30 узлов). Возьмём первую половину данной /26:

| Параметр | Значение |
|---|---|
| Подсеть для 30 узлов | `10.10.1.64/27` |
| Маска | `255.255.255.224` |
| Сетевой | `10.10.1.64` |
| Диапазон узлов | `10.10.1.65 – 10.10.1.94` |
| Broadcast | `10.10.1.95` |
| Кол-во узлов | 30 |

### Сеть `10.10.1.0/26`

**Характеристики исходной сети**
- Префикс: `/26`
- Маска: `255.255.255.192`
- Сетевой адрес: `10.10.1.0`
- Диапазон узлов: `10.10.1.1 – 10.10.1.62`
- Broadcast: `10.10.1.63`
- (Классическая модель) Базовая сеть класса A `10.0.0.0/8`, занято `26 − 8 = 18` бит → **число подсетей: `2^18 = 262 144`**

**Выделить подсеть на 14 узлов.** Нужен префикс `/28` (16 адресов, 14 узлов). Берём первую /28 внутри данной /26:

| Параметр | Значение |
|---|---|
| Подсеть для 14 узлов | `10.10.1.0/28` |
| Маска | `255.255.255.240` |
| Сетевой | `10.10.1.0` |
| Диапазон узлов | `10.10.1.1 – 10.10.1.14` |
| Broadcast | `10.10.1.15` |
| Кол-во узлов | 14 |


## Разбиение IPv6-сети на подсети

### Сеть `2001:db8:c0de::/48`

**Характеристики**
- Префикс: `/48`
- Маска (битовая форма): `ffff:ffff:ffff:0000:0000:0000:0000:0000`
- Сетевой адрес: `2001:db8:c0de:0000:0000:0000:0000:0000`
- Диапазон адресов в сети (краевые значения):
  - минимальный хост в первом /64: `2001:db8:c0de:0::1`
  - максимальный адрес сети: `2001:db8:c0de:ffff:ffff:ffff:ffff:ffff`
- Внутри /48 по стандартной практике формируются подсети /64 (16 бит Subnet ID) → **65 536** подсетей /64.

Разбиение с использованием идентификатора подсети (Subnet ID)

Занимаем 1 старший бит поля Subnet ID (из 16 бит), получаем **две сети /49**:

1. `2001:db8:c0de:0000::/49` — охватывает Subnet ID `0x0000 … 0x7fff`
   - крайние /64 внутри диапазона: `2001:db8:c0de:0000::/64 … 2001:db8:c0de:7fff::/64`
2. `2001:db8:c0de:8000::/49` — охватывает Subnet ID `0x8000 … 0xffff`
   - крайние /64 внутри диапазона: `2001:db8:c0de:8000::/64 … 2001:db8:c0de:ffff::/64`

Разбиение с использованием идентификатора интерфейса (Interface ID)

Берём один конкретный /64 из /48 (например, `2001:db8:c0de:0::/64`) и делим его,
одалживая 1 старший бит из 64-битного **Interface ID** → получаем **две сети /65**:

1. `2001:db8:c0de:0:0000:0000:0000:0000/65`
   - хост-диапазон: `…:0`–`…:7fff:ffff:ffff:ffff`
2. `2001:db8:c0de:0:8000:0000:0000:0000/65`
   - хост-диапазон: `…:8000:0000:0000:0000`–`…:ffff:ffff:ffff:ffff`

### Сеть `2a02:6b8::/64`

**Характеристики**
- Префикс: `/64`
- Маска (битовая форма): `ffff:ffff:ffff:ffff:0000:0000:0000:0000`
- Сетевой адрес: `2a02:6b8:0000:0000:0000:0000:0000:0000`
- Диапазон адресов узлов:
  - минимальный хост: `2a02:6b8::1`
  - максимальный хост: `2a02:6b8::ffff:ffff:ffff:ffff`
- Внутри /64 поле Subnet ID отсутствует (всё «нижние» 64 бита — Interface ID).

Разбиение с использованием идентификатора подсети

**Неприменимо напрямую к /64.** В сети /64 нет оставшихся бит Subnet ID — поле Subnet ID уже исчерпано.  
Если доступна **родительская аллокация /48** (например, `2a02:6b8::/48`), тогда разбиение по Subnet ID дало бы два /49 или два /64 с разными Subnet ID, например:
- `2a02:6b8:0::/64` и `2a02:6b8:1::/64` (пример при наличии /48).

Разбиение с использованием идентификатора интерфейса

Делим предоставленную сеть /64, занимая 1 бит из Interface ID → **две сети /65**:

1. `2a02:6b8:0:0:0000:0000:0000:0000/65`
   - хост-диапазон: `…:0`–`…:7fff:ffff:ffff:ffff`
2. `2a02:6b8:0:0:8000:0000:0000:0000/65`
   - хост-диапазон: `…:8000:0000:0000:0000`–`…:ffff:ffff:ffff:ffff`

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

1. Запущены GNS3 VM и GNS3, создан новый проект.

2. В рабочей области размещены устройства согласно топологии:
   - Коммутаторы: msk-hamdimohammad-sw-01 … msk-hamdimohammad-sw-05
   - Маршрутизаторы: msk-hamdimohammad-gw-01 (FRR), msk-hamdimohammad-gw-02 (VyOS)
   - Узлы VPCS: PC1-hamdimohammad, PC2-hamdimohammad, PC3-hamdimohammad, PC4-hamdimohammad, Server-hamdimohammad

   Устройства соединены линками согласно схеме.

   ![Топология сети](Screenshot_1.png){ #fig:001 width=80% }

3. Всем устройствам присвоены названия по требованиям задания. Проверено, что соединения активны.

4. На PC1-hamdimohammad настроен адрес:

   ip 172.16.20.10/25 172.16.20.1  
   save

   Выполнена проверка конфигурации IPv4/IPv6.

   ![Конфигурация IP на PC1](Screenshot_2.png){ #fig:002 width=60% }

5. На Server-hamdimohammad настроен адрес:

   ip 64.100.1.10/24 64.100.1.1  
   save

   ![Конфигурация сервера](Screenshot_3.png){ #fig:003 width=60% }

6. На PC2-hamdimohammad выполнена аналогичная настройка:

   ip 172.16.20.138/25 172.16.20.129  
   save

   ![Конфигурация IP на PC2](Screenshot_4.png){ #fig:004 width=60% }

7. На маршрутизаторе msk-hamdimohammad-gw-01 выполнена настройка интерфейсов:

   interface eth0 → 172.16.20.1/25  
   interface eth1 → 172.16.20.129/25  
   interface eth2 → 64.100.1.1/24  

   Конфигурация сохранена.

   ![Настройка FRR](Screenshot_5.png){ #fig:005 width=60% }

8. Проверена текущая конфигурация маршрутизатора. Адреса присвоены корректно.

   ![Проверка running-config](Screenshot_6.png){ #fig:006 width=60% }

9. Вызвана команда ping с PC1-hamdimohammad:
   - успешный обмен ICMP-пакетами с PC2
   - успешная доступность сервера (64.100.1.10)

   ![Проверка связности PC1](Screenshot_7.png){ #fig:007 width=70% }

10. Для узлов PC3, PC4 и сервера настроена IPv6-адресация согласно таблице задания.

   Узел PC3-hamdimohammad получил адрес:  
   `2001:db8:c0de:12::a/64`  

   ![Конфигурация PC3](Screenshot_8.png){ #fig:008 width=60% }

   Узел PC4-hamdimohammad получил адрес:  
   `2001:db8:c0de:13::a/64`  

   ![Конфигурация PC4](Screenshot_9.png){ #fig:009 width=60% }

   На сервере настроен адрес:  
   `2001:db8:c0de:11::a/64`  

   ![Конфигурация IPv6 сервера](Screenshot_10.png){ #fig:010 width=60% }

11. Маршрутизатор VyOS установлен и перезагружен. Устройство переименовано в `msk-hamdimohammad-gw-02`.

   ![Переименование маршрутизатора VyOS](Screenshot_11.png){ #fig:011 width=70% }

12. На маршрутизаторе настроены IPv6-адреса и SLAAC-раздача префиксов на всех интерфейсах:

   Интерфейс `eth0` — подсеть с PC3:  
   `2001:db8:c0de:12::1/64`

   Интерфейс `eth1` — подсеть с PC4:  
   `2001:db8:c0de:13::1/64`

   Интерфейс `eth2` — подсеть сервера:  
   `2001:db8:c0de:11::1/64`

   ![Настройка IPv6 интерфейсов VyOS](Screenshot_12.png){ #fig:012 width=70% }

   Конфигурация сохранена и проверена.

   ![Вывод show interfaces](Screenshot_13.png){ #fig:013 width=65% }

13. Проверена связность между узлами IPv6-подсети:
   - PC3 успешно отправляет ICMPv6-эхо на PC4 и сервер
   - Попытка обратиться к IPv4-адресу завершается ошибкой

   ![Ping PC3](Screenshot_14.png){ #fig:014 width=60% }

14. На сервере подтверждена возможность связи с подсетями IPv4 и IPv6:
   - сервер получает ответы от PC2 по IPv4
   - сервер получает ответы от PC4 по IPv6

   ![Пинг с сервера Dual Stack](Screenshot_15.png){ #fig:015 width=60% }

15. На интерфейсе сервера двойного стека был выполнен захват трафика. Наблюдались три типа пакетов:  
   – ARP (для IPv4)  
   – ICMP Echo (ping)  
   – ICMPv6 Echo (ping)

На кадрах ARP видно, что сервер пытается определить MAC-адрес узла, которому отправляет трафик IPv4.  
В примере сервер с IPv4-адресом `64.100.1.10` выполняет ARP-запрос: *«Кто имеет 64.100.1.1? Сообщите 64.100.1.10»*.  

![ARP-трафик](Screenshot_16.png){ #fig:016 width=90% }

Из анализа ARP можно получить:
- MAC-адрес источника: `0c:2a:f8:51:00:02`
- MAC-адрес цели (после ответа): `00:50:79:66:68:04`
- IPv4-адреса участников ARP

Это подтверждает, что перед отправкой ICMP IPv4 сервер определяет MAC-адрес шлюза.

Следующие пакеты — ICMP Echo Request / Echo Reply между сервером и узлом `172.16.20.138` (PC2).  

![ICMP IPv4 трафик](Screenshot_17.png){ #fig:017 width=90% }

Из ICMP-пакетов можно извлечь:
- IPv4-адрес источника: `64.100.1.10`
- IPv4-адрес назначения: `172.16.20.138`
- TTL = 64
- Идентификатор и номер последовательности — используются для сопоставления запрос/ответ

Эти пакеты подтверждают корректную маршрутизацию IPv4 через FRR-маршрутизатор.

Далее виден ICMPv6 (ping) между сервером и PC4:  

![ICMPv6 трафик](Screenshot_18.png){ #fig:018 width=90% }

Из ICMPv6 можно извлечь:
- IPv6-адрес источника: `2001:db8:c0de:11::a`
- IPv6-адрес назначения: `2001:db8:c0de:13::a`
- Значение Hop Limit = 64 (аналог TTL)
- Идентификатор и номер последовательности

Это подтверждает нормальную работу IPv6 и маршрутизацию через VyOS.

## Самостоятельная часть

### Подсеть 1 — IPv4 `10.10.1.96/27`
- Размер: 32 адреса.
- Сетевой адрес: `10.10.1.96`.
- Шлюз/минимальный хост: `10.10.1.97`.
- Диапазон хостов: `10.10.1.97` – `10.10.1.126`.
- Широковещательный адрес: `10.10.1.127`.

### Подсеть 2 — IPv4 `10.10.1.16/28`
- Размер: 16 адресов.
- Сетевой адрес: `10.10.1.16`.
- Шлюз/минимальный хост: `10.10.1.17`.
- Диапазон хостов: `10.10.1.17` – `10.10.1.30`.
- Широковещательный адрес: `10.10.1.31`.

### Подсети IPv6
- Подсеть 1: `2001:db8:1:1::/64`  
  Минимальный адрес интерфейса маршрутизатора: `2001:db8:1:1::1`; произвольные адреса хостов — в пределах префикса.
- Подсеть 2: `2001:db8:1:4::/64`  
  Минимальный адрес интерфейса маршрутизатора: `2001:db8:1:4::1`; произвольные адреса хостов — в пределах префикса.

### Таблица адресации

| Узел/Интерфейс | IPv4 адрес / маска | Шлюз (IPv4) | IPv6 адрес / префикс | Шлюз (IPv6) |
|---|---|---|---|---|
| `msk-hamdimohammad-gw-01` `eth0` (к Подсети 1) | `10.10.1.97/27` | — | `2001:db8:1:1::1/64` | — |
| `msk-hamdimohammad-gw-01` `eth1` (к Подсети 2) | `10.10.1.17/28` | — | `2001:db8:1:4::1/64` | — |
| `PC1-hamdimohammad` (Подсеть 1) | `10.10.1.100/27` | `10.10.1.97` | `2001:db8:1:1::a/64` | `fe80::/64` → `2001:db8:1:1::1` (по умолчанию) |
| `PC2-hamdimohammad` (Подсеть 2) | `10.10.1.20/28` | `10.10.1.17` | `2001:db8:1:4::a/64` | `fe80::/64` → `2001:db8:1:4::1` (по умолчанию) |

Топология проекта:

![Топология двух подсетей](Screenshot_19.png){ #fig:019 width=75% }

### Настройка адресации

PC1 (подсеть 1)
- IPv4: `10.10.1.100/27`, шлюз `10.10.1.97`.  
- IPv6: `2001:db8:1:1::a/64`.

![PC1: show ip/ipv6](Screenshot_20.png){ #fig:020 width=60%_)

PC2 (подсеть 2)
- IPv4: `10.10.1.20/28`, шлюз `10.10.1.17`.  
- IPv6: `2001:db8:1:4::a/64`.

![PC2: show ip/ipv6](Screenshot_21.png){ #fig:021 width=60% }

Маршрутизатор VyOS `msk-hamdimohammad-gw-01`
- `eth0`: `10.10.1.97/27`, `2001:db8:1:1::1/64`.  
- `eth1`: `10.10.1.17/28`, `2001:db8:1:4::1/64`.  
- Конфигурация сохранена.

![VyOS: интерфейсы](Screenshot_22.png){ #fig:022 width=60% }

### Проверка связности

ICMP (IPv4)
- С `PC1` до `PC2`: успешные ответы на `10.10.1.20`.

ICMPv6
- С `PC1` до `PC2`: успешные ответы на `2001:db8:1:4::a`.

![Проверка ping](Screenshot_23.png){ #fig:023 width=65% }


# Заключение  

В ходе лабораторной работы смоделированы сети с маршрутизаторами **FRR** и **VyOS**, выполнена настройка IP-адресации и проверка связности. 
Захват трафика в **Wireshark** подтвердил корректную работу протоколов ARP и ICMP.